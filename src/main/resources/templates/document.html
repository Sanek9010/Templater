<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Document</title>
    <script th:replace="fragments/header :: headerElement"></script>
    <script type="text/javascript" th:src="@{/js/scriptsDocument.js}"></script>
</head>
<body>
<!--@thymesVar id="document" type="com.templater.domain.Document"-->
<div th:replace="fragments/header :: header"></div>
<div class="container" th:if="${document != null}">
    <div class="card mt-3">
        <div class="card-header">
            <h2>Create document</h2>
        </div>
        <div class="card-body">
            <form th:object="${document}" action="" method="post" id="documentForm">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" th:field="${document.id}"   />
                <input type="hidden" th:field="${document.user}"   />
                <input type="hidden" th:field="${document.template}"   />
                <div class = "form-row col-12 border border-secondary rounded m-2 p-2">
                    <div class="input-group mb-3">
                        <span th:text="${document.template.name}"></span>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <label for="name" class="input-group-text">Name:</label>
                        </div>
                        <input type="text" class="form-control" th:field="${document.name}"/>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <label for="dateOfCreation" class="input-group-text">Date of creation:</label>
                        </div>
                        <input type="text" class="form-control" th:field="${document.dateOfCreation}"/>
                    </div>
                </div>

                <div th:each="placeholder,i: ${document.placeholders}" class="input-group m-2 p-2 border border-secondary rounded">
                    <input type="hidden" th:field="*{placeholders[__${i.index}__].id}"   />
                    <input type="hidden" th:field="*{placeholders[__${i.index}__].type}"   />
                    <input type="hidden" th:field="*{placeholders[__${i.index}__].name}"   />
                    <input type="hidden" th:field="*{placeholders[__${i.index}__].document}" />
                    <div class="input-group-prepend col-12">
                        <span class="input-group-text" th:text="${placeholder.type}"></span>
                        <label for="dateOfCreation" class="input-group-text" th:text="${placeholder.name}"></label>
                    </div>

                    <div th:if="${placeholder.type=='ListSdt'}"  th:id="${placeholder.name}" th:text="${placeholder.contentXml}">
                        <input type="hidden" th:field="*{placeholders[__${i.index}__].contentXml}" />
                        <ol th:id="'List'+${i.index}+'lvl-1'">
                            <li contenteditable>
                                <script th:inline="javascript">
                                    /*<![CDATA[*/
                                    var name = /*[[${placeholder.name}]]*/ 'default';
                                    var headers = /*[[${placeholder.contentXml}]]*/ 'defaultHeader';
                                    headers = JSON.parse(headers);
                                    var table = document.getElementById(/*[['Table'+${i.index}]]*/'defaultTable');
                                    var row = table.insertRow(0);
                                    var i;
                                    for (i = 0; i < headers.length; i++) {
                                        row.insertCell(i).innerText =headers[i];
                                    }
                                    function addRow() {
                                        var headers = /*[[${placeholder.contentXml}]]*/ 'defaultHeader';
                                        headers = JSON.parse(headers);
                                        var table = document.getElementById(/*[['Table'+${i.index}]]*/'defaultTable');
                                        var row = table.insertRow(-1);
                                        for (i = 0; i < headers.length; i++) {
                                            var cell = row.insertCell(i);
                                            cell.setAttribute('contenteditable','true');
                                        }
                                    }
                                    function save() {
                                        var inputContent = document.getElementById(/*[[placeholders__${i.index}__.contentXml]]*/'defaultTable');
                                        inputContent.value = table.outerHTML;
                                    }
                                    /*]]>*/
                                </script>
                            </li>
                        </ol>
                        <button type="button" class="btn btn-primary m-4" onclick="addRow()">Add item</button>
                        <button type="button" class="btn btn-primary m-4" onclick="save()">Save</button>
                    </div>

                    <div class="col-12 mt-2" th:if="${placeholder.type=='TableSdt'}">
                        <input type="hidden" th:field="*{placeholders[__${i.index}__].contentXml}" />
                        <table class="table table-bordered"  th:id="'Table'+${i.index}">
                            <script th:inline="javascript">
                                /*<![CDATA[*/
                               var name = /*[[${placeholder.name}]]*/ 'default';
                                var headers = /*[[${placeholder.contentXml}]]*/ 'defaultHeader';
                                headers = JSON.parse(headers);
                                var table = document.getElementById(/*[['Table'+${i.index}]]*/'defaultTable');
                                var row = table.insertRow(0);
                                var i;
                                for (i = 0; i < headers.length; i++) {
                                    row.insertCell(i).innerText =headers[i];
                                }
                                function addRow() {
                                    var headers = /*[[${placeholder.contentXml}]]*/ 'defaultHeader';
                                    headers = JSON.parse(headers);
                                    var table = document.getElementById(/*[['Table'+${i.index}]]*/'defaultTable');
                                    var row = table.insertRow(-1);
                                    for (i = 0; i < headers.length; i++) {
                                        var cell = row.insertCell(i);
                                        cell.setAttribute('contenteditable','true');
                                    }
                                }
                                function save() {
                                    var inputContent = document.getElementById(/*[[placeholders__${i.index}__.contentXml]]*/'defaultTable');
                                    inputContent.value = table.outerHTML;
                                }
                                /*]]>*/
                            </script>
                        </table>
                        <button type="button" class="btn btn-primary m-4" onclick="addRow()">Add row</button>
                        <button type="button" class="btn btn-primary m-4" onclick="save()">Save</button>
                    </div>
                    <div class="col-12 mt-2" th:if="${placeholder.type=='SimpleSdt'}">
                        <input type="text" class="form-control" th:field="*{placeholders[__${i.index}__].contentXml}"/>
                    </div>
                </div>

                <div class = "form-group row col-3">
                    <button type="submit" class="btn btn-primary m-4">Save document</button>
                </div>
            </form>

<!--            <div class="card col-12 m-2" id="partsList"></div>-->

<!--            <div id="paragraphForm" class="card" hidden>-->
<!--                <textarea name="content" id="editor" hidden>-->
<!--                </textarea>-->
<!--                <button type="button" id="postEditor" class="btn btn-primary" onclick="postPart()">Save</button>-->
<!--            </div>-->

<!--            <div class="btn-group row m-3 col-auto" role="group" aria-label="Basic example" id="createButtons">-->
<!--                <button type="button" id="createParagraphButton" class="btn btn-secondary col-auto" onclick="createParagraph()" >Add Paragraph</button>-->
<!--                <button type="button" id="createPictureButton" class="btn btn-secondary col-auto" onclick="createPicture()">Add Picture</button>-->
<!--                <button type="button" id="createTableButton" class="btn btn-secondary col-auto" onclick="createTable()">Add Table</button>-->
<!--            </div>-->
<!--            <a href="/templates" class="btn btn-secondary">Back</a>-->
<!--            <a id="getDocx" class="btn btn-info ml-4">Download docx</a>-->

        </div>
    </div>
</div>

</body>
</html>